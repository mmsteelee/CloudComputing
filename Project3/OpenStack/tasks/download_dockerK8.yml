---
- name: Install Docker
  apt:
    name: docker.io
    state: latest
    update_cache: yes

- name: Docker mod (from slides)
  replace:
    path: /lib/systemd/system/docker.service
    regexp: 'ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock'
    replace: 'ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock --exec-opt native.cgroupdriver=systemd'

- name: Restart service docker and daemon-reload
  ansible.builtin.systemd:
    state: restarted
    daemon_reload: yes
    name: docker

# kubernetes install
#- name: K8 Dependancies
#  shell: "apt install apt-transport-https curl"
#- name: Curl K8 key
#  shell: "curl -fsSLo /usr/share/keyrings/kubernetes-archive-keyring.gpg https://packages.cloud.google.com/apt/doc/apt-key.gpg"
#- name: Add K8 key
#  shell: 'echo "deb [signed-by=/usr/share/keyrings/kubernetes-archive-keyring.gpg]  https://apt.kubernetes.io/ kubernetes-xenial main" | sudo tee -a /etc/apt/sources.list.d/kubernetes.list'

#- name: Add Kubernetes Repository
#  apt_repository:
#    repo: deb http://apt.kubernetes.io/ kubernetes-xenial main
#    state: present
#    filename: kubernetes
#    mode: 0600
- name: Installing Kubernetes Cluster Packages.
  apt:
    pkg:
      - kubeadm
      - kubectl
      - kubelet
      - kubernetes-cni
    state: latest
    update_cache: true

#- name: Apt update
#  shell: "apt update"
#
#- name: Install K8
#  shell: "apt install kubeadm kubelet kubectl kubernetes-cni"

- name: Disable K8 swap
  command: swapoff -a

- name: Docker Modification
  shell: "systemctl daemon-reload"

- name: Docker Modification
  shell: "systemctl restart docker"

- name: Check Docker Status
  shell: "systemctl status docker"
...